==============================
External
==============================

external x : int = "x"
external x : int = "x" "x"
external x : 'a . 'a = "x"
external%ext x : int = "x"
external x : int = {| x |}
external x : int = {| x |} {| x |}

---

(compilation_unit
  (external
    (value_name)
    (type_constructor_path (type_constructor))
    (string (string_content)))
  (external
    (value_name)
    (type_constructor_path (type_constructor))
    (string (string_content))
    (string (string_content)))
  (external
    (value_name)
    (polymorphic_type (type_variable) (type_variable))
    (string (string_content)))
  (external
    (attribute_id)
    (value_name)
    (type_constructor_path (type_constructor))
    (string (string_content)))
  (external
    (value_name)
    (type_constructor_path (type_constructor))
    (quoted_string (quoted_string_content)))
  (external
    (value_name)
    (type_constructor_path (type_constructor))
    (quoted_string (quoted_string_content))
    (quoted_string (quoted_string_content))))

==============================
Type definition
==============================

type t
type nonrec 'a t = t and ('a, 'b) t = t
type t = private t
type t = A | B of t | C of t * t | D of {x : t}
type _ t =
  | A : t -> t
  | B : 'a . 'a -> 'a t
type t = {
  mutable x : t;
}
type t = t constraint 'a = t
type t = |
type t = ..
type t = private ..

---

(compilation_unit
  (type_definition (type_binding (type_constructor)))
  (type_definition
    (type_binding
      (type_variable)
      (type_constructor)
      (type_constructor_path (type_constructor)))
    (type_binding
      (type_variable) (type_variable)
      (type_constructor)
      (type_constructor_path (type_constructor))))
  (type_definition (type_binding (type_constructor) (type_constructor_path (type_constructor))))
  (type_definition
    (type_binding
      (type_constructor)
      (variant_declaration
        (constructor_declaration (constructor_name))
        (constructor_declaration
          (constructor_name)
          (type_constructor_path (type_constructor)))
        (constructor_declaration
          (constructor_name)
          (type_constructor_path (type_constructor))
          (type_constructor_path (type_constructor)))
        (constructor_declaration
          (constructor_name)
          (record_declaration
            (field_declaration
              (field_name)
              (type_constructor_path (type_constructor))))))))
  (type_definition
    (type_binding
      (type_variable)
      (type_constructor)
      (variant_declaration
        (constructor_declaration
          (constructor_name)
          (type_constructor_path (type_constructor))
          (type_constructor_path (type_constructor)))
        (constructor_declaration
          (constructor_name)
          (type_variable)
          (type_variable)
          (constructed_type (type_variable) (type_constructor_path (type_constructor)))))))
  (type_definition
    (type_binding
      (type_constructor)
      (record_declaration
        (field_declaration (field_name) (type_constructor_path (type_constructor))))))
  (type_definition
    (type_binding
      (type_constructor)
      (type_constructor_path (type_constructor))
      (type_constraint (type_variable) (type_constructor_path (type_constructor)))))
  (type_definition
    (type_binding
      (type_constructor)
      (variant_declaration)))
  (type_definition
    (type_binding
      (type_constructor)))
  (type_definition
    (type_binding
      (type_constructor))))

==============================
Type synonyms in type definitions
==============================

type t = t = A | B
type t = t = private A | B
type t = t = { x : t; x : t }
type t = t = private { x : t; x : t }
type t = t = ..
type t = t = private ..

---

(compilation_unit
  (type_definition
    (type_binding
      (type_constructor)
      (type_synonym
        (type_constructor_path
          (type_constructor)))
      (variant_declaration
        (constructor_declaration
          (constructor_name))
        (constructor_declaration
          (constructor_name)))))
  (type_definition
    (type_binding
      (type_constructor)
      (type_synonym
        (type_constructor_path
          (type_constructor)))
      (variant_declaration
        (constructor_declaration
          (constructor_name))
        (constructor_declaration
          (constructor_name)))))
  (type_definition
    (type_binding
      (type_constructor)
      (type_synonym
        (type_constructor_path
          (type_constructor)))
      (record_declaration
        (field_declaration
          (field_name)
          (type_constructor_path
            (type_constructor)))
        (field_declaration
          (field_name)
          (type_constructor_path
            (type_constructor))))))
  (type_definition
    (type_binding
      (type_constructor)
      (type_synonym
        (type_constructor_path
          (type_constructor)))
      (record_declaration
        (field_declaration
          (field_name)
          (type_constructor_path
            (type_constructor)))
        (field_declaration
          (field_name)
          (type_constructor_path
            (type_constructor))))))
  (type_definition
    (type_binding
      (type_constructor)
      (type_synonym
        (type_constructor_path
          (type_constructor)))))
  (type_definition
    (type_binding
      (type_constructor)
      (type_synonym
        (type_constructor_path
          (type_constructor))))))

==============================
Exception definition
==============================

exception E
exception E of t

---

(compilation_unit
  (exception_definition (constructor_declaration (constructor_name)))
  (exception_definition
    (constructor_declaration
      (constructor_name)
      (type_constructor_path (type_constructor)))))

==============================
Module definition
==============================

module M
module M : T
module M (M : T) : E
module rec M : T and M : T

module M = M
module M := M
module M : T = M
module M (M : T) = M
module rec M = N and N = M

module _ (_ : T) = M

---

(compilation_unit
  (module_definition
    (module_binding
      (module_name)))
  (module_definition
    (module_binding
      (module_name)
      (module_type_path (module_type_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_parameter (module_name) (module_type_path (module_type_name)))
      (module_type_path (module_type_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_type_path (module_type_name)))
    (module_binding
      (module_name)
      (module_type_path (module_type_name))))

  (module_definition
    (module_binding
      (module_name)
      (module_path (module_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_path (module_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_type_path (module_type_name))
      (module_path (module_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_parameter (module_name) (module_type_path (module_type_name)))
      (module_path (module_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_path (module_name)))
    (module_binding
      (module_name)
      (module_path (module_name))))
  (module_definition
    (module_binding
      (module_name)
      (module_parameter (module_name) (module_type_path (module_type_name)))
      (module_path (module_name)))))

==============================
Module type definition
==============================

module type T = T
module type T := T
module type T = T with type t := t -> t

---

(compilation_unit
  (module_type_definition
    (module_type_name)
    (module_type_path (module_type_name)))
  (module_type_definition
    (module_type_name)
    (module_type_path (module_type_name)))
  (module_type_definition
    (module_type_name)
    (module_type_constraint
      (module_type_path (module_type_name))
      (constrain_type
        (type_constructor_path
          (type_constructor))
        (function_type
          (type_constructor_path
            (type_constructor))
          (type_constructor_path
            (type_constructor)))))))

==============================
Module type definitions with functors
==============================

module type T = T -> T
module type T = T -> T with type t := t

---

(compilation_unit
  (module_type_definition
    (module_type_name)
    (functor_type
      (module_type_path (module_type_name))
      (module_type_path (module_type_name))))
  (module_type_definition
    (module_type_name)
    (functor_type
      (module_type_path (module_type_name))
      (module_type_constraint
        (module_type_path (module_type_name))
        (constrain_type
          (type_constructor_path
            (type_constructor))
          (type_constructor_path
            (type_constructor)))))))

==============================
Open
==============================

open M
open! M
open ! M

---

(compilation_unit
  (open_module (module_path (module_name)))
  (open_module (module_path (module_name)))
  (open_module (module_path (module_name))))

==============================
Value specifications in structures
==============================

module M = struct
  val x : t
  let x = x
end

---

(compilation_unit
  (module_definition
    (module_binding
      (module_name)
      (structure
        (value_specification
          (value_name)
          (type_constructor_path
            (type_constructor)))
        (value_definition
          (let_binding
            (value_name)
            (value_path
              (value_name))))))))

==============================
Value specifications in attributes
==============================

val x : t
  [@@attr
    val x : t
    let x = x
  ]

---

(compilation_unit
  (value_specification
    (value_name)
    (type_constructor_path
      (type_constructor))
    (item_attribute
      (attribute_id)
      (attribute_payload
        (value_specification
          (value_name)
          (type_constructor_path
            (type_constructor)))
        (value_definition
          (let_binding
            (value_name)
            (value_path
              (value_name))))))))
